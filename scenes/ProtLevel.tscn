[gd_scene load_steps=19 format=2]

[ext_resource path="res://textures/lights/light.png" type="Texture" id=1]
[ext_resource path="res://default_env.tres" type="Environment" id=2]
[ext_resource path="res://textures/environment/map.jpg" type="Texture" id=3]
[ext_resource path="res://scenes/Player/Bernard.tscn" type="PackedScene" id=4]
[ext_resource path="res://scenes/Hazards/VehicleSpawner.gd" type="Script" id=5]
[ext_resource path="res://scenes/ProtLevel.gd" type="Script" id=6]
[ext_resource path="res://scenes/Environment/PolygonWall.tscn" type="PackedScene" id=7]
[ext_resource path="res://scenes/Player/Hewie.tscn" type="PackedScene" id=8]
[ext_resource path="res://scenes/InteractiveEnv/InteractiveInput.tscn" type="PackedScene" id=9]
[ext_resource path="res://scenes/InteractiveEnv/InteractiveOutput.tscn" type="PackedScene" id=10]
[ext_resource path="res://scenes/Environment/Tree.tscn" type="PackedScene" id=12]
[ext_resource path="res://scenes/InteractiveEnv/Mechanism.tscn" type="PackedScene" id=13]
[ext_resource path="res://scenes/Environment/RoadSegment.tscn" type="PackedScene" id=15]
[ext_resource path="res://scenes/Environment/Crosswalk.tscn" type="PackedScene" id=16]

[sub_resource type="Shader" id=1]
code = "shader_type canvas_item;

uniform float red = 24.0;
uniform float green = 24.0;
uniform float blue = 24.0;

void fragment()
{
	float r = red / 255.0;
	float g = green / 255.0;
	float b = blue / 255.0;
	
	COLOR = vec4(r, g, b, 1.);
}"

[sub_resource type="ShaderMaterial" id=2]
shader = SubResource( 1 )
shader_param/red = 103.0
shader_param/green = 106.0
shader_param/blue = 99.0

[sub_resource type="NavigationPolygon" id=3]
vertices = PoolVector2Array( -1296, 1744, -1504, -2232, -1192, -2256, -968, 1728 )
polygons = [ PoolIntArray( 0, 1, 2, 3 ) ]
outlines = [ PoolVector2Array( -1296, 1744, -1504, -2232, -1192, -2256, -968, 1728 ) ]

[sub_resource type="NavigationPolygon" id=4]
vertices = PoolVector2Array( -3176, -1736, -3512, 2184, -4288, 2112, -3944, -1808 )
polygons = [ PoolIntArray( 0, 1, 2, 3 ) ]
outlines = [ PoolVector2Array( -3944, -1808, -4288, 2112, -3512, 2184, -3176, -1736 ) ]

[node name="World" type="Node2D"]
script = ExtResource( 6 )

[node name="WorldEnvironment" type="WorldEnvironment" parent="."]
environment = ExtResource( 2 )

[node name="Light2D" type="Light2D" parent="WorldEnvironment"]
visible = false
enabled = false
texture = ExtResource( 1 )
texture_scale = 50.0
energy = 1.1
mode = 1
range_item_cull_mask = 7

[node name="CanvasModulate" type="CanvasModulate" parent="."]
color = Color( 0, 0, 0, 1 )

[node name="Sprite" type="Sprite" parent="."]
light_mask = 2
material = SubResource( 2 )
position = Vector2( 1696, 1024 )
scale = Vector2( 19.4951, 23.085 )
texture = ExtResource( 3 )

[node name="Road" type="Node2D" parent="."]
position = Vector2( -1280, -256 )

[node name="RoadSegment" parent="Road" instance=ExtResource( 15 )]
position = Vector2( 80, 1056 )
rotation = -0.0635716
scale = Vector2( 5, 30 )

[node name="Crosswalk" parent="Road" instance=ExtResource( 16 )]
position = Vector2( 16, 32 )
rotation = -0.0642722
scale = Vector2( 5, 2 )
can_be_crossed = true

[node name="RoadSegment2" parent="Road" instance=ExtResource( 15 )]
position = Vector2( -48, -992 )
rotation = -0.0635716
scale = Vector2( 5, 30 )

[node name="Road2" type="Node2D" parent="."]
position = Vector2( -3736, 152 )
rotation = 0.150808

[node name="RoadSegment" parent="Road2" instance=ExtResource( 15 )]
position = Vector2( 80, 1056 )
rotation = -0.0635716
scale = Vector2( 13, 30 )

[node name="Crosswalk" parent="Road2" instance=ExtResource( 16 )]
position = Vector2( 16, 32 )
rotation = -0.0642722
scale = Vector2( 13, 2 )
can_be_crossed = true

[node name="RoadSegment2" parent="Road2" instance=ExtResource( 15 )]
position = Vector2( -48, -992 )
rotation = -0.0635716
scale = Vector2( 13, 30 )

[node name="B_House" type="Node2D" parent="."]
position = Vector2( -432, -528 )

[node name="PolygonWall" parent="B_House" instance=ExtResource( 7 )]

[node name="Polygon2D" parent="B_House/PolygonWall" index="0"]
color = Color( 0.12549, 0.156863, 0.278431, 1 )
polygon = PoolVector2Array( -656, -592, -624, -592, -576, 32, -160, 32, -160, -240, 96, -240, 96, -64, 640, -64, 640, 704, -16, 704, -160, 848, -560, 848, -608, 160, 16, 160, 16, 576, -16, 576, -16, 192, -432, 192, -560, 352, -528, 816, -160, 816, -16, 672, -16, 640, 16, 640, 16, 672, 96, 672, 96, 416, 128, 416, 128, 640, 608, 640, 608, 304, 128, 304, 128, 352, 96, 352, 96, 272, 608, 272, 608, -32, 256, -32, 256, 0, 224, 0, 224, -32, 128, -32, 128, 112, 224, 112, 224, 64, 256, 64, 256, 144, 128, 144, 128, 208, 96, 208, 96, 64, 0, 64, 0, 32, 64, -16, 64, -208, -128, -208, -128, 32, -48, 32, -48, 64, -544, 64, -544, 96, -608, 96 )

[node name="LivingRoomDoor" type="Node2D" parent="B_House"]
position = Vector2( 432, 528 )

[node name="Mechanism" parent="B_House/LivingRoomDoor" instance=ExtResource( 13 )]
position = Vector2( -432, 80 )

[node name="InteractiveOutput" parent="B_House/LivingRoomDoor/Mechanism" instance=ExtResource( 10 )]
rotation = 1.5708
type = "Door"

[node name="InteractiveInput" parent="B_House/LivingRoomDoor/Mechanism" instance=ExtResource( 9 )]
position = Vector2( 32, -80 )
type = "DogButton"

[node name="InteractiveInput2" parent="B_House/LivingRoomDoor/Mechanism" instance=ExtResource( 9 )]
position = Vector2( -32, -80 )
type = "DogButton"

[node name="BedroomDoor" type="Node2D" parent="B_House"]
position = Vector2( 112, 384 )

[node name="Mechanism" parent="B_House/BedroomDoor" instance=ExtResource( 13 )]

[node name="InteractiveOutput" parent="B_House/BedroomDoor/Mechanism" instance=ExtResource( 10 )]
rotation = 1.5708
type = "Door"

[node name="InteractiveInput" parent="B_House/BedroomDoor/Mechanism" instance=ExtResource( 9 )]
position = Vector2( -32, -64 )
type = "DogButton"

[node name="EntryDoor" type="Node2D" parent="B_House"]

[node name="Mechanism" parent="B_House/EntryDoor" instance=ExtResource( 13 )]
position = Vector2( -592, 128 )

[node name="InteractiveOutput" parent="B_House/EntryDoor/Mechanism" instance=ExtResource( 10 )]
position = Vector2( 16, 0 )
rotation = 1.5708
type = "Door"

[node name="InteractiveInput" parent="B_House/EntryDoor/Mechanism" instance=ExtResource( 9 )]
position = Vector2( 504, -168 )
type = "Key"

[node name="WorldBorder" type="Node2D" parent="."]
position = Vector2( -1520, -336 )

[node name="PolygonWall" parent="WorldBorder" instance=ExtResource( 7 )]

[node name="Polygon2D" parent="WorldBorder/PolygonWall" index="0"]
color = Color( 0.12549, 0.156863, 0.278431, 1 )
polygon = PoolVector2Array( -2664, -816, -1520, -816, -1608, 24, -984, -48, -992, -816, -785.749, -816, -776, 72, -48, -40, -96, -816, 464, -816, 464, -784, -48, -784, -16, -16, -808, 104, -816, -784, -944, -784, -944, -24, -1656, 56, -1568, -784, -2624, -784, -2824, 1584, -1712, 1584, -1664, 1136, -1208, 1136, -1248, 1584, -1064, 1584, -984, 632, -376, 632, -416, 336, 16, 272, 104, 1584, 576, 1584, 528, 656, 560, 656, 608, 1616, 48, 1616, -16, 312, -368, 368, -328, 664, -952, 680, -1008, 1616, -1288, 1616, -1256, 1184, -1624, 1176, -1672, 1616, -2872, 1616 )

[node name="Environment" type="Node2D" parent="."]

[node name="PolygonWall" parent="Environment" instance=ExtResource( 7 )]
position = Vector2( -2896, 208 )

[node name="Polygon2D" parent="Environment/PolygonWall" index="0"]
color = Color( 0.12549, 0.156863, 0.278431, 1 )
polygon = PoolVector2Array( -224, -376, 360, -432, 272, 488, 48, 488, 48, 456, 248, 456, 328, -400, -192, -352, -232, 456, 48, 456, 48, 488, -272, 488 )

[node name="Navigation" type="Node2D" parent="."]

[node name="Navigation2D" type="Navigation2D" parent="Navigation"]

[node name="NavigationPolygonInstance" type="NavigationPolygonInstance" parent="Navigation/Navigation2D"]
navpoly = SubResource( 3 )

[node name="NavigationPolygonInstance2" type="NavigationPolygonInstance" parent="Navigation/Navigation2D"]
navpoly = SubResource( 4 )

[node name="YSort" type="YSort" parent="."]

[node name="Bernard" parent="YSort" instance=ExtResource( 4 )]
position = Vector2( -3262, 416 )

[node name="Hewie" parent="YSort" instance=ExtResource( 8 )]
position = Vector2( -3424, 24 )

[node name="YSortTrafficLights" type="YSort" parent="YSort"]

[node name="Mechanism" parent="YSort/YSortTrafficLights" instance=ExtResource( 13 )]
position = Vector2( -3280, 304 )
ID = "HOLA"

[node name="InteractiveOutput2" parent="YSort/YSortTrafficLights/Mechanism" instance=ExtResource( 10 )]
position = Vector2( -40, -168 )
type = "TrafficLight"

[node name="InteractiveOutput" parent="YSort/YSortTrafficLights/Mechanism" instance=ExtResource( 10 )]
position = Vector2( -856, -232 )
type = "TrafficLight"

[node name="InteractiveInput" parent="YSort/YSortTrafficLights/Mechanism" instance=ExtResource( 9 )]
position = Vector2( -880, -80 )
type = "DogButton"

[node name="InteractiveInput2" parent="YSort/YSortTrafficLights/Mechanism" instance=ExtResource( 9 )]
position = Vector2( -40, 0 )
type = "DogButton"

[node name="Mechanism2" parent="YSort/YSortTrafficLights" instance=ExtResource( 13 )]
position = Vector2( -1248, -232 )

[node name="InteractiveOutput" parent="YSort/YSortTrafficLights/Mechanism2" instance=ExtResource( 10 )]
position = Vector2( 152, 80 )
type = "TrafficLight"

[node name="InteractiveOutput2" parent="YSort/YSortTrafficLights/Mechanism2" instance=ExtResource( 10 )]
position = Vector2( -184, 112 )
type = "TrafficLight"

[node name="YSortDecoTrees" type="YSort" parent="YSort"]

[node name="Tree2" parent="YSort/YSortDecoTrees" instance=ExtResource( 12 )]
position = Vector2( -1072, -864 )

[node name="Tree3" parent="YSort/YSortDecoTrees" instance=ExtResource( 12 )]
position = Vector2( -1512, -984 )

[node name="Tree4" parent="YSort/YSortDecoTrees" instance=ExtResource( 12 )]
position = Vector2( -1088, -1016 )

[node name="Tree6" parent="YSort/YSortDecoTrees" instance=ExtResource( 12 )]
position = Vector2( -2848, 720 )
scale = Vector2( 0.605464, 0.605464 )

[node name="StaticBody2D" parent="YSort/YSortDecoTrees" instance=ExtResource( 12 )]
position = Vector2( -1000, 400 )

[node name="VehicleSpawner" type="Node2D" parent="YSort"]
position = Vector2( -1192, -240 )
script = ExtResource( 5 )
spawn_base = 6
randomness_range = 3.0

[node name="VehiclesInitialPosition" type="Position2D" parent="YSort/VehicleSpawner"]
position = Vector2( 120, 1832 )
rotation = -0.0669232

[node name="VehiclesGoalPosition" type="Position2D" parent="YSort/VehicleSpawner"]
position = Vector2( -136, -1864 )

[node name="TimerSpawnRate" type="Timer" parent="YSort/VehicleSpawner"]

[node name="VehicleSpawner2" type="Node2D" parent="YSort"]
position = Vector2( -1344, -352 )
script = ExtResource( 5 )
spawn_base = 4
randomness_range = 2.0

[node name="VehiclesInitialPosition" type="Position2D" parent="YSort/VehicleSpawner2"]
position = Vector2( 120, 1832 )
rotation = -0.059138

[node name="VehiclesGoalPosition" type="Position2D" parent="YSort/VehicleSpawner2"]
position = Vector2( -112, -1632 )

[node name="TimerSpawnRate" type="Timer" parent="YSort/VehicleSpawner2"]

[node name="VehicleSpawner3" type="Node2D" parent="YSort"]
position = Vector2( -3696, 224 )
script = ExtResource( 5 )
spawn_base = 3
randomness_range = 1.0

[node name="VehiclesInitialPosition" type="Position2D" parent="YSort/VehicleSpawner3"]
position = Vector2( 88, 1816 )
rotation = 0.088647

[node name="VehiclesGoalPosition" type="Position2D" parent="YSort/VehicleSpawner3"]
position = Vector2( 448, -1848 )

[node name="TimerSpawnRate" type="Timer" parent="YSort/VehicleSpawner3"]

[node name="VehicleSpawner4" type="Node2D" parent="YSort"]
position = Vector2( -3848, -56 )
script = ExtResource( 5 )
spawn_base = 5
randomness_range = 1.0

[node name="VehiclesInitialPosition" type="Position2D" parent="YSort/VehicleSpawner4"]
position = Vector2( 88, 1816 )
rotation = 0.117921

[node name="VehiclesGoalPosition" type="Position2D" parent="YSort/VehicleSpawner4"]
position = Vector2( 440, -1640 )

[node name="TimerSpawnRate" type="Timer" parent="YSort/VehicleSpawner4"]

[node name="VehicleSpawner5" type="Node2D" parent="YSort"]
position = Vector2( -4072, 168 )
script = ExtResource( 5 )
spawn_base = 5
randomness_range = 3.0

[node name="VehiclesInitialPosition" type="Position2D" parent="YSort/VehicleSpawner5"]
position = Vector2( 464, -1776 )
rotation = 3.2447

[node name="VehiclesGoalPosition" type="Position2D" parent="YSort/VehicleSpawner5"]
position = Vector2( 88, 1816 )

[node name="TimerSpawnRate" type="Timer" parent="YSort/VehicleSpawner5"]

[node name="VehicleSpawner6" type="Node2D" parent="YSort"]
position = Vector2( -4248, -144 )
script = ExtResource( 5 )
spawn_base = 2

[node name="VehiclesInitialPosition" type="Position2D" parent="YSort/VehicleSpawner6"]
position = Vector2( 376, -1432 )
rotation = 3.21678

[node name="VehiclesGoalPosition" type="Position2D" parent="YSort/VehicleSpawner6"]
position = Vector2( 88, 1816 )

[node name="TimerSpawnRate" type="Timer" parent="YSort/VehicleSpawner6"]
[connection signal="toggle_harness" from="YSort/Bernard" to="YSort/Hewie" method="_on_Bernard_toggle_harness"]
[connection signal="give_key" from="YSort/Hewie" to="YSort/Bernard" method="_on_Hewie_give_key"]
[connection signal="timeout" from="YSort/VehicleSpawner/TimerSpawnRate" to="YSort/VehicleSpawner" method="_on_TimerSpawnRate_timeout"]
[connection signal="timeout" from="YSort/VehicleSpawner2/TimerSpawnRate" to="YSort/VehicleSpawner2" method="_on_TimerSpawnRate_timeout"]
[connection signal="timeout" from="YSort/VehicleSpawner3/TimerSpawnRate" to="YSort/VehicleSpawner3" method="_on_TimerSpawnRate_timeout"]
[connection signal="timeout" from="YSort/VehicleSpawner4/TimerSpawnRate" to="YSort/VehicleSpawner4" method="_on_TimerSpawnRate_timeout"]
[connection signal="timeout" from="YSort/VehicleSpawner5/TimerSpawnRate" to="YSort/VehicleSpawner5" method="_on_TimerSpawnRate_timeout"]
[connection signal="timeout" from="YSort/VehicleSpawner6/TimerSpawnRate" to="YSort/VehicleSpawner6" method="_on_TimerSpawnRate_timeout"]

[editable path="B_House/PolygonWall"]

[editable path="WorldBorder/PolygonWall"]

[editable path="Environment/PolygonWall"]
