[gd_scene load_steps=23 format=2]

[ext_resource path="res://textures/lights/light.png" type="Texture" id=1]
[ext_resource path="res://default_env.tres" type="Environment" id=2]
[ext_resource path="res://textures/environment/map.jpg" type="Texture" id=3]
[ext_resource path="res://scenes/Player/Bernard.tscn" type="PackedScene" id=4]
[ext_resource path="res://scenes/Hazards/VehicleSpawner.tscn" type="PackedScene" id=5]
[ext_resource path="res://scenes/ProtLevel.gd" type="Script" id=6]
[ext_resource path="res://scenes/Environment/PolygonWall.tscn" type="PackedScene" id=7]
[ext_resource path="res://scenes/Player/Hewie.tscn" type="PackedScene" id=8]
[ext_resource path="res://scenes/InteractiveEnv/InteractiveInput.tscn" type="PackedScene" id=9]
[ext_resource path="res://scenes/InteractiveEnv/InteractiveOutput.tscn" type="PackedScene" id=10]
[ext_resource path="res://textures/animated_textures/environment/AT_Fountain.tres" type="Texture" id=11]
[ext_resource path="res://scenes/Environment/Tree.tscn" type="PackedScene" id=12]
[ext_resource path="res://scenes/InteractiveEnv/Mechanism.tscn" type="PackedScene" id=13]
[ext_resource path="res://textures/environment/fountain/0000.png" type="Texture" id=14]
[ext_resource path="res://scenes/Environment/RoadSegment.tscn" type="PackedScene" id=15]
[ext_resource path="res://scenes/Environment/Crosswalk.tscn" type="PackedScene" id=16]

[sub_resource type="Shader" id=1]
code = "shader_type canvas_item;

uniform float red = 24.0;
uniform float green = 24.0;
uniform float blue = 24.0;

void fragment()
{
	float r = red / 255.0;
	float g = green / 255.0;
	float b = blue / 255.0;
	
	COLOR = vec4(r, g, b, 1.);
}"

[sub_resource type="ShaderMaterial" id=2]
shader = SubResource( 1 )
shader_param/red = 103.0
shader_param/green = 106.0
shader_param/blue = 99.0

[sub_resource type="NavigationPolygon" id=3]
vertices = PoolVector2Array( -4288, 2112, -3944, -1808, -3200, -1448, -3448, 1680, -992, 2400, -1272, 1880, -1248, -2176, -1504, -1648, -1504, -2160, -3928, -2056 )
polygons = [ PoolIntArray( 0, 1, 2, 3 ), PoolIntArray( 4, 0, 3, 5 ), PoolIntArray( 6, 4, 5, 7, 8 ), PoolIntArray( 9, 8, 7, 2, 1 ) ]
outlines = [ PoolVector2Array( -3944, -1808, -4288, 2112, -992, 2400, -1248, -2176, -1504, -2160, -3928, -2056, -3944, -1808, -3200, -1448, -1504, -1648, -1272, 1880, -3448, 1680, -3200, -1448 ) ]

[sub_resource type="OccluderPolygon2D" id=6]
cull_mode = 1
polygon = PoolVector2Array( -9.49245, 30.0238, -7.78963, -22.423, 7.53575, -22.423, 11.6225, 29.6833 )

[sub_resource type="Curve2D" id=4]
bake_interval = 200.0
_data = {
"points": PoolVector2Array( 0, 0, 0, 0, -1296, -2136, 78.4984, -270.569, -78.4984, 270.569, -3880, -1720, -71.4983, -212.672, 71.4983, 212.672, -4096, 1944, -62.7267, 49.7374, 62.7267, -49.7374, -1080, 2272, 0, 0, 0, 0, -1296, -2136 )
}

[sub_resource type="Curve2D" id=5]
bake_interval = 200.0
_data = {
"points": PoolVector2Array( 157.883, -18.5458, -157.883, 18.5458, -2800, -1872, 95.8168, -148.361, -95.8168, 148.361, -3632, -1664, -301.706, -126.615, 301.706, 126.615, -3768, 1816, 0, 0, 0, 0, -3016, 2016, -116.496, 130.478, 116.496, -130.478, -1112, 2256, 124.894, 43.3603, -124.894, -43.3603, -1376, -2016, 45.4639, 3.43902, -45.4639, -3.43902, -2600, -1896, 0, 0, 0, 0, -2800, -1872 )
}

[node name="World" type="Node2D"]
script = ExtResource( 6 )

[node name="WorldEnvironment" type="WorldEnvironment" parent="."]
environment = ExtResource( 2 )

[node name="Light2D" type="Light2D" parent="WorldEnvironment"]
visible = false
enabled = false
texture = ExtResource( 1 )
texture_scale = 50.0
energy = 1.1
mode = 1
range_item_cull_mask = 7

[node name="CanvasModulate" type="CanvasModulate" parent="."]
color = Color( 0, 0, 0, 1 )

[node name="Sprite" type="Sprite" parent="."]
light_mask = 2
material = SubResource( 2 )
position = Vector2( 1696, 1024 )
scale = Vector2( 19.4951, 23.085 )
texture = ExtResource( 3 )

[node name="Roads" type="Node2D" parent="."]

[node name="RoadEast" type="Node2D" parent="Roads"]
position = Vector2( -1280, -256 )

[node name="RoadSegment" parent="Roads/RoadEast" instance=ExtResource( 15 )]
position = Vector2( 104, 1296 )
rotation = -0.0635716
scale = Vector2( 4.89569, 37.5565 )

[node name="Crosswalk" parent="Roads/RoadEast" instance=ExtResource( 16 )]
position = Vector2( 16, 32 )
rotation = -0.0642722
scale = Vector2( 5, 2 )
can_be_crossed = true

[node name="RoadSegment2" parent="Roads/RoadEast" instance=ExtResource( 15 )]
position = Vector2( -48, -992 )
rotation = -0.0635716
scale = Vector2( 5, 30 )

[node name="RoadWest" type="Node2D" parent="Roads"]
position = Vector2( -3736, 152 )
rotation = 0.150808

[node name="RoadSegment" parent="Roads/RoadWest" instance=ExtResource( 15 )]
position = Vector2( 80, 1056 )
rotation = -0.0635716
scale = Vector2( 13, 30 )

[node name="Crosswalk" parent="Roads/RoadWest" instance=ExtResource( 16 )]
position = Vector2( 16, 32 )
rotation = -0.0642722
scale = Vector2( 13, 2 )
can_be_crossed = true

[node name="RoadSegment2" parent="Roads/RoadWest" instance=ExtResource( 15 )]
position = Vector2( -48, -992 )
rotation = -0.0635716
scale = Vector2( 13, 30 )

[node name="RoadSouth" type="Node2D" parent="Roads"]

[node name="RoadSegment" parent="Roads/RoadSouth" instance=ExtResource( 15 )]
position = Vector2( -2632, 2008 )
rotation = 0.0933165
scale = Vector2( 52.2671, 8.4 )

[node name="CollisionPolygon2D" parent="Roads/RoadSouth/RoadSegment" index="0"]
scale = Vector2( 0.983991, 0.979096 )
polygon = PoolVector2Array( -32, -32, 32, -32, 33.4465, 32.2048, -32, 32 )

[node name="Polygon2D" parent="Roads/RoadSouth/RoadSegment" index="1"]
polygon = PoolVector2Array( -32, -32, 31.4983, -31.7341, 32.911, 31.5316, -32, 32 )

[node name="RoadNorth" type="Node2D" parent="Roads"]
position = Vector2( -2584, -1832 )

[node name="RoadSegment" parent="Roads/RoadNorth" instance=ExtResource( 15 )]
position = Vector2( -16, -24 )
rotation = -0.0604422
scale = Vector2( 42.878, 8.64021 )

[node name="CollisionPolygon2D" parent="Roads/RoadNorth/RoadSegment" index="0"]
polygon = PoolVector2Array( -31.0283, -30.653, 32.1558, -31.1573, 32.3207, 31.9688, -32.2745, 25.5562 )

[node name="Polygon2D" parent="Roads/RoadNorth/RoadSegment" index="1"]
polygon = PoolVector2Array( -31.192, -32.5574, 32.3534, -32.0256, 32.3207, 31.9688, -32.6469, 25.4443 )

[node name="B_House" type="Node2D" parent="."]
position = Vector2( -432, -528 )

[node name="PolygonWall" parent="B_House" instance=ExtResource( 7 )]

[node name="Polygon2D" parent="B_House/PolygonWall" index="0"]
color = Color( 0.12549, 0.156863, 0.278431, 1 )
polygon = PoolVector2Array( -656, -592, -624, -592, -576, 32, -160, 32, -160, -240, 96, -240, 96, -64, 640, -64, 640, 704, -16, 704, -160, 848, -560, 848, -608, 160, 16, 160, 16, 576, -16, 576, -16, 192, -432, 192, -560, 352, -528, 816, -160, 816, -16, 672, -16, 640, 16, 640, 16, 672, 96, 672, 96, 416, 128, 416, 128, 640, 608, 640, 608, 304, 128, 304, 128, 352, 96, 352, 96, 272, 608, 272, 608, -32, 256, -32, 256, 0, 224, 0, 224, -32, 128, -32, 128, 112, 224, 112, 224, 64, 256, 64, 256, 144, 128, 144, 128, 208, 96, 208, 96, 64, 0, 64, 0, 32, 64, -16, 64, -208, -128, -208, -128, 32, -48, 32, -48, 64, -544, 64, -544, 96, -608, 96 )

[node name="LivingRoomDoor" type="Node2D" parent="B_House"]
position = Vector2( 432, 528 )

[node name="Mechanism" parent="B_House/LivingRoomDoor" instance=ExtResource( 13 )]
position = Vector2( -432, 80 )

[node name="InteractiveOutput" parent="B_House/LivingRoomDoor/Mechanism" instance=ExtResource( 10 )]
rotation = 1.5708
type = "Door"

[node name="InteractiveInput" parent="B_House/LivingRoomDoor/Mechanism" instance=ExtResource( 9 )]
position = Vector2( 32, -80 )
type = "DogButton"

[node name="InteractiveInput2" parent="B_House/LivingRoomDoor/Mechanism" instance=ExtResource( 9 )]
position = Vector2( -32, -80 )
type = "DogButton"

[node name="BedroomDoor" type="Node2D" parent="B_House"]
position = Vector2( 112, 384 )

[node name="Mechanism" parent="B_House/BedroomDoor" instance=ExtResource( 13 )]

[node name="InteractiveOutput" parent="B_House/BedroomDoor/Mechanism" instance=ExtResource( 10 )]
rotation = 1.5708
type = "Door"

[node name="InteractiveInput" parent="B_House/BedroomDoor/Mechanism" instance=ExtResource( 9 )]
position = Vector2( -32, -64 )
type = "DogButton"

[node name="EntryDoor" type="Node2D" parent="B_House"]

[node name="Mechanism" parent="B_House/EntryDoor" instance=ExtResource( 13 )]
position = Vector2( -592, 128 )

[node name="InteractiveOutput" parent="B_House/EntryDoor/Mechanism" instance=ExtResource( 10 )]
position = Vector2( 16, 0 )
rotation = 1.5708
type = "Door"

[node name="InteractiveInput" parent="B_House/EntryDoor/Mechanism" instance=ExtResource( 9 )]
position = Vector2( 504, -168 )
type = "Key"

[node name="WorldBorder" type="Node2D" parent="."]
position = Vector2( -1520, -336 )

[node name="PolygonWall" parent="WorldBorder" instance=ExtResource( 7 )]

[node name="Polygon2D" parent="WorldBorder/PolygonWall" index="0"]
color = Color( 0.12549, 0.156863, 0.278431, 1 )
polygon = PoolVector2Array( -2544, -1904, 408, -2016, 464, -784, 432, -784, 368, -1976, -2496, -1856, -2896, 2568, 664, 2856, 584, 1056, 544, 656, 568, 656, 624, 1056, 696, 2904, -2952, 2616 )

[node name="Environment" type="Node2D" parent="."]

[node name="PolygonWall" parent="Environment" instance=ExtResource( 7 )]
position = Vector2( -2896, 208 )

[node name="Polygon2D" parent="Environment/PolygonWall" index="0"]
color = Color( 0.12549, 0.156863, 0.278431, 1 )
polygon = PoolVector2Array( -224, -376, 360, -432, 272, 488, 48, 488, 48, 456, 248, 456, 328, -400, -192, -352, -232, 456, 48, 456, 48, 488, -272, 488 )

[node name="PolygonWall2" parent="Environment" instance=ExtResource( 7 )]
position = Vector2( -2416, 1432 )

[node name="Polygon2D" parent="Environment/PolygonWall2" index="0"]
color = Color( 0.12549, 0.156863, 0.278431, 1 )
polygon = PoolVector2Array( -744, -600, -216, -600, -248, -120, 72, -88, 128, -1496, 896, -1568, 984, 120, 480, 96, 480, 56, 944, 88, 864, -1528, 168, -1464, 112, -48, -296, -80, -264, -552, -704, -560, -760, -32, 480, 56, 480, 96, -816, 8 )

[node name="PolygonWall3" parent="Environment" instance=ExtResource( 7 )]
position = Vector2( -2824, -776 )

[node name="Polygon2D" parent="Environment/PolygonWall3" index="0"]
color = Color( 0.12549, 0.156863, 0.278431, 1 )
polygon = PoolVector2Array( -216, -688, 624, -760, 632, -456, 536, -336, 184, -336, 184, 320, 160, 344, 160, 328, 160, 304, 160, 256, 160, -360, 520, -360, 608, -464, 600, -736, -184, -664, -216, 336, 136, 328, 152, 320, 152, 344, -216, 360, -248, 344 )

[node name="Navigation" type="Node2D" parent="."]

[node name="Navigation2D" type="Navigation2D" parent="Navigation"]

[node name="NavigationPolygonInstance2" type="NavigationPolygonInstance" parent="Navigation/Navigation2D"]
navpoly = SubResource( 3 )

[node name="Fountain" type="Node2D" parent="."]
position = Vector2( -2032, -816 )
scale = Vector2( 4, 4 )
z_index = 1

[node name="SprShadow" type="Sprite" parent="Fountain"]
modulate = Color( 0, 0, 0, 0.117647 )
position = Vector2( -1.22778, 45.807 )
scale = Vector2( 0.402, 0.457 )
z_index = -1
texture = ExtResource( 14 )
flip_h = true
flip_v = true

[node name="Area2D" type="StaticBody2D" parent="Fountain"]
position = Vector2( 0, 30.5857 )
collision_layer = 3

[node name="CollisionPolygon2D" type="CollisionPolygon2D" parent="Fountain/Area2D"]
polygon = PoolVector2Array( -82.8156, 51.2386, -92.3514, 43.4056, -99.8438, 31.8265, -99.5033, 19.9067, -88.6052, 8.66811, -76.0044, 0.494576, -53.5271, -5.29501, -32.4122, -3.93275, -20.4924, -0.867683, 1.64423, -14.1497, -0.0585938, -32.1996, 11.18, -51.6117, 26.5054, -57.4013, 42.5119, -58.7636, 62.9458, -57.4013, 83.3796, -50.2495, 96.6616, -40.3731, 99.0455, -24.026, 90.1909, -6.99783, 72.8221, 3.21909, 50.3449, 6.96529, 28.6627, 6.91158, 18.3656, 5.68348, 5.80125, 13.241, 7.43382, 16.8416, 8.45551, 31.4859, 1.9848, 41.7028, -9.59438, 51.9197, -23.8981, 56.3471, -45.3536, 58.0499, -67.1497, 58.0499 )

[node name="LightOccluder2D" type="LightOccluder2D" parent="Fountain"]
visible = false
light_mask = 7
occluder = SubResource( 6 )
light_mask = 7

[node name="YSort" type="YSort" parent="."]

[node name="Bernard" parent="YSort" instance=ExtResource( 4 )]
position = Vector2( -3216, 184 )

[node name="Hewie" parent="YSort" instance=ExtResource( 8 )]
position = Vector2( -3368, -200 )

[node name="SprFountain1" type="Sprite" parent="YSort"]
position = Vector2( -1752, -844 )
scale = Vector2( 1.6, 1.6 )
texture = ExtResource( 11 )
region_enabled = true
region_rect = Rect2( 274, 0, 312, 312 )

[node name="SprFountain2" type="Sprite" parent="YSort"]
position = Vector2( -2216, -644 )
scale = Vector2( 1.6, 1.6 )
texture = ExtResource( 11 )
offset = Vector2( 0, -25 )
region_enabled = true
region_rect = Rect2( 0, 0, 278, 512 )

[node name="YSortTrafficLights" type="YSort" parent="YSort"]

[node name="Mechanism" parent="YSort/YSortTrafficLights" instance=ExtResource( 13 )]
position = Vector2( -3280, 304 )
ID = "HOLA"

[node name="InteractiveOutput2" parent="YSort/YSortTrafficLights/Mechanism" instance=ExtResource( 10 )]
position = Vector2( -40, -168 )
type = "TrafficLight"

[node name="InteractiveOutput" parent="YSort/YSortTrafficLights/Mechanism" instance=ExtResource( 10 )]
position = Vector2( -856, -232 )
type = "TrafficLight"

[node name="InteractiveInput" parent="YSort/YSortTrafficLights/Mechanism" instance=ExtResource( 9 )]
position = Vector2( -880, -80 )
type = "DogButton"

[node name="InteractiveInput2" parent="YSort/YSortTrafficLights/Mechanism" instance=ExtResource( 9 )]
position = Vector2( -40, 0 )
type = "DogButton"

[node name="Mechanism2" parent="YSort/YSortTrafficLights" instance=ExtResource( 13 )]
position = Vector2( -1248, -232 )

[node name="InteractiveOutput" parent="YSort/YSortTrafficLights/Mechanism2" instance=ExtResource( 10 )]
position = Vector2( 152, 80 )
type = "TrafficLight"

[node name="InteractiveOutput2" parent="YSort/YSortTrafficLights/Mechanism2" instance=ExtResource( 10 )]
position = Vector2( -184, 112 )
type = "TrafficLight"

[node name="YSortDecoTrees" type="YSort" parent="YSort"]

[node name="Tree2" parent="YSort/YSortDecoTrees" instance=ExtResource( 12 )]
position = Vector2( -1072, -864 )

[node name="Tree3" parent="YSort/YSortDecoTrees" instance=ExtResource( 12 )]
position = Vector2( -1512, -984 )

[node name="Tree4" parent="YSort/YSortDecoTrees" instance=ExtResource( 12 )]
position = Vector2( -1088, -1016 )

[node name="Tree6" parent="YSort/YSortDecoTrees" instance=ExtResource( 12 )]
position = Vector2( -2848, 720 )
scale = Vector2( 0.605464, 0.605464 )

[node name="Tree5" parent="YSort/YSortDecoTrees" instance=ExtResource( 12 )]
position = Vector2( -1000, 400 )

[node name="Tree" parent="YSort/YSortDecoTrees" instance=ExtResource( 12 )]
position = Vector2( -1928, 1608 )

[node name="Tree7" parent="YSort/YSortDecoTrees" instance=ExtResource( 12 )]
position = Vector2( -2664, -416 )
scale = Vector2( 0.382146, 0.382146 )

[node name="Tree9" parent="YSort/YSortDecoTrees" instance=ExtResource( 12 )]
position = Vector2( -2760, -448 )
scale = Vector2( 0.624723, 0.624723 )

[node name="Tree8" parent="YSort/YSortDecoTrees" instance=ExtResource( 12 )]
position = Vector2( -2704, -448 )

[node name="Tree10" parent="YSort/YSortDecoTrees" instance=ExtResource( 12 )]
position = Vector2( -2832, -448 )
scale = Vector2( 0.90684, 0.90684 )

[node name="Tree11" parent="YSort/YSortDecoTrees" instance=ExtResource( 12 )]
position = Vector2( -2936, -432 )
scale = Vector2( 1.1056, 1.29312 )

[node name="Tree12" parent="YSort/YSortDecoTrees" instance=ExtResource( 12 )]
position = Vector2( -3032, -440 )
scale = Vector2( 0.77695, 0.77695 )

[node name="Spawners" type="Node2D" parent="."]

[node name="VehicleSpawner" parent="Spawners" instance=ExtResource( 5 )]
spawn_base = 5
randomness_range = 1.0
max_cars = 8
randomness_range_max = 4.0
is_path_closed = true

[node name="Path2D" parent="Spawners/VehicleSpawner" index="0"]
curve = SubResource( 4 )

[node name="VehicleSpawner2" parent="Spawners" instance=ExtResource( 5 )]
spawn_base = 2
randomness_range = 1.0
max_cars = 9
randomness_range_max = 3.0
is_path_closed = true

[node name="Path2D" parent="Spawners/VehicleSpawner2" index="0"]
curve = SubResource( 5 )

[node name="VehicleSpawner3" parent="Spawners" instance=ExtResource( 5 )]
spawn_base = 8
randomness_range = 4.0
max_cars = 13
randomness_range_max = 4.0
is_path_closed = true
[connection signal="toggle_harness" from="YSort/Bernard" to="YSort/Hewie" method="_on_Bernard_toggle_harness"]
[connection signal="give_key" from="YSort/Hewie" to="YSort/Bernard" method="_on_Hewie_give_key"]

[editable path="Roads/RoadSouth/RoadSegment"]

[editable path="Roads/RoadNorth/RoadSegment"]

[editable path="B_House/PolygonWall"]

[editable path="WorldBorder/PolygonWall"]

[editable path="Environment/PolygonWall"]

[editable path="Environment/PolygonWall2"]

[editable path="Environment/PolygonWall3"]

[editable path="Spawners/VehicleSpawner"]

[editable path="Spawners/VehicleSpawner2"]

[editable path="Spawners/VehicleSpawner3"]
